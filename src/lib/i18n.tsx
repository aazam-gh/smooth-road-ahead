import React, { createContext, useContext, useMemo } from 'react';
import { LanguageCode } from '../../types';

type Dict = Record<string, string>;

const en: Dict = {
  'app.brand': 'DriveSense',
  'app.analyzing': 'Analyzing...',
  'app.calculate': 'Calculate PRR Score',
  'app.calc_failed': 'Failed to calculate PRR score. Please try again.',

  'nav.home': 'Home',
  'nav.chat': 'DriveSense Chat',
  'nav.profile': 'Profile',
  'nav.version': 'DriveSense Module v1.3',

  'vehicle.title': 'Vehicle Profile',
  'vehicle.vin': 'VIN',
  'vehicle.odometer': 'Odometer (miles)',
  'vehicle.lastServiceDate': 'Last Service Date',
  'vehicle.lastOilChangeDate': 'Last Oil Change Date',
  'vehicle.lastOilChangeMileage': 'Last Oil Change (miles)',
  'vehicle.lastAirFilterChangeMiles': 'Last Air Filter Change (miles)',
  'vehicle.tireAgeMonths': 'Tire Age (months)',
  'vehicle.batteryAgeMonths': 'Battery Age (months)',
  'vehicle.insuranceExpiryDate': 'Insurance Expiry Date',
  'vehicle.zipCode': 'Zip Code',

  'env.title': 'Environmental Data',
  'env.currentTemp': 'Current Temperature (°C)',
  'env.daysAbove45': 'Days > 45°C (Last 90 Days)',
  'env.sandstorms': 'Sandstorm Events (Last 30 Days)',
  'env.dustLevel': 'Dust Level',
  'env.weatherForecastSummary': 'Weather Forecast (summary)',
  'env.dust.low': 'Low',
  'env.dust.medium': 'Medium',
  'env.dust.high': 'High',
  'env.select': 'Select',

  'results.prr_label': 'PREDICTIVE RISK & REPAIR SCORE',
  'results.score.excellent': 'EXCELLENT',
  'results.score.good': 'GOOD',
  'results.score.attention': 'ATTENTION',
  'results.priority': 'Priority Car Care',
  'results.book_service': 'Book QIC Service & Earn Loyalty Points',
  'results.ai_recs': 'AI Recommendations',
  'results.urgency': 'Urgency',
  'results.run_new': 'Run New Analysis',
  'results.nearby_garages': 'Nearby Garages:',

  'chat.title': 'DriveSense Chat',
  'chat.find_garages': 'Find Nearby Garages',
  'chat.placeholder': 'Ask about your vehicle...',
  'chat.connecting': 'Connecting voice...',
  'chat.live': 'Live',
  'chat.voice_connecting_msg': 'Connecting to voice agent...',
  'chat.voice_open_msg': 'Connection opened. You can start speaking.',
  'chat.voice_closed_msg': 'Voice connection closed.',
  'chat.voice_perm_error': 'Could not access microphone. Please grant permission and try again.',
  'chat.voice_key_error': 'Voice chat requires GEMINI_API_KEY. Add it to a .env file and restart.',
  'chat.location_error': "I couldn't access your location. Please enable location permissions in your browser settings to use this feature.",
  'chat.maps_error': "Sorry, I couldn't find garages near you. Please ensure location services are enabled.",

  'login.welcome': 'Welcome to DriveSense',
  'login.subtitle': 'Sign in to continue',
  'login.username': 'Username',
  'login.password': 'Password',
  'login.signin': 'Sign In',
  'login.username_ph': 'Enter any username',
  'login.password_ph': 'Enter any password',

  'profile.member': 'QIC Member',
  'profile.name': 'Name',
  'profile.language': 'Language',
  'profile.drivingStyle': 'Driving Style',
  'profile.style.calm': 'Calm',
  'profile.style.normal': 'Normal',
  'profile.style.aggressive': 'Aggressive',
  'profile.loyalty_points': 'QIC Loyalty Points',
  'profile.service_history': 'Service History',

  'welcome.title': 'CareCast',
  'welcome.subtitle': 'Predictive maintenance for your vehicle. Never miss a service again.',
  'welcome.feature1.title': 'Smart Predictions',
  'welcome.feature1.desc': 'AI-powered maintenance forecasting based on your driving habits',
  'welcome.feature2.title': 'Timely Alerts',
  'welcome.feature2.desc': 'Get notified before issues become expensive problems',
  'welcome.get_started': 'Get Started',
  'welcome.have_account': 'I already have an account',

  'onboarding.choose_setup': 'Choose Your Setup',
  'onboarding.select_usage': 'Select how you\'ll be using CareCast',
  'onboarding.back': 'Back',
  'onboarding.type.personal': 'Personal Vehicle',
  'onboarding.type.personal_desc': 'Track maintenance for your personal car',
  'onboarding.type.family': 'Family Fleet',
  'onboarding.type.family_desc': 'Manage multiple family vehicles',
  'onboarding.type.commercial': 'Commercial Fleet',
  'onboarding.type.commercial_desc': 'Professional fleet management',

  'onboarding.vehicle_details': 'Vehicle Details',
  'onboarding.basic_info': 'Tell us about your vehicle',
  'onboarding.make': 'Make',
  'onboarding.make_ph': 'e.g., Toyota',
  'onboarding.model': 'Model',
  'onboarding.model_ph': 'e.g., Camry',
  'onboarding.year': 'Year',
  'onboarding.year_ph': 'e.g., 2020',
  'onboarding.mileage': 'Current Mileage',
  'onboarding.mileage_ph': 'e.g., 45000',
  'onboarding.continue': 'Continue',

  'dashboard.vehicle_health': 'Vehicle Health',
  'dashboard.excellent': 'Excellent',
  'dashboard.upcoming_maintenance': 'Upcoming Maintenance',
  'dashboard.oil_change': 'Oil Change',
  'dashboard.tire_rotation': 'Tire Rotation',
  'dashboard.brake_inspection': 'Brake Inspection',
  'dashboard.due_in': 'Due in',
  'dashboard.miles': 'miles',
  'dashboard.recent_service': 'Recent Service History',
  'dashboard.view_all': 'View All',

  'account.title': 'Account',
  'account.profile': 'Profile',
  'account.email': 'Email',
  'account.phone': 'Phone',
  'account.vehicle_info': 'Vehicle Information',
  'account.preferences': 'Preferences',
  'account.notifications': 'Notifications',
  'account.notification_desc': 'Receive maintenance reminders',
  'account.language': 'Language',
  'account.logout': 'Logout',
};

const ar: Dict = {
  'app.brand': 'درايف سنس',
  'app.analyzing': 'جاري التحليل...',
  'app.calculate': 'احسب درجة المخاطر والصيانة',
  'app.calc_failed': 'فشل في حساب الدرجة. يرجى المحاولة لاحقًا.',

  'nav.home': 'الرئيسية',
  'nav.chat': 'محادثة درايف سنس',
  'nav.profile': 'الملف الشخصي',
  'nav.version': 'إصدار درايف سنس 1.3',

  'vehicle.title': 'بيانات المركبة',
  'vehicle.vin': 'رقم الهيكل (VIN)',
  'vehicle.odometer': 'عداد المسافة (ميل)',
  'vehicle.lastServiceDate': 'تاريخ آخر صيانة',
  'vehicle.lastOilChangeDate': 'تاريخ آخر تغيير زيت',
  'vehicle.lastOilChangeMileage': 'المسافة منذ آخر تغيير زيت (ميل)',
  'vehicle.lastAirFilterChangeMiles': 'المسافة منذ تغيير فلتر الهواء (ميل)',
  'vehicle.tireAgeMonths': 'عمر الإطارات (بالأشهر)',
  'vehicle.batteryAgeMonths': 'عمر البطارية (بالأشهر)',
  'vehicle.insuranceExpiryDate': 'تاريخ انتهاء التأمين',
  'vehicle.zipCode': 'الرمز البريدي',

  'env.title': 'البيئة المحيطة',
  'env.currentTemp': 'درجة الحرارة الحالية (°م)',
  'env.daysAbove45': 'الأيام فوق 45°م (آخر 90 يومًا)',
  'env.sandstorms': 'عواصف رملية (آخر 30 يومًا)',
  'env.dustLevel': 'مستوى الغبار',
  'env.weatherForecastSummary': 'ملخص حالة الطقس',
  'env.dust.low': 'منخفض',
  'env.dust.medium': 'متوسط',
  'env.dust.high': 'مرتفع',
  'env.select': 'اختر',

  'results.prr_label': 'درجة المخاطر والصيانة التنبؤية',
  'results.score.excellent': 'ممتاز',
  'results.score.good': 'جيد',
  'results.score.attention': 'بحاجة للاهتمام',
  'results.priority': 'أولويات العناية بالمركبة',
  'results.book_service': 'احجز خدمة QIC واحصل على نقاط الولاء',
  'results.ai_recs': 'توصيات الذكاء الاصطناعي',
  'results.urgency': 'الأولوية',
  'results.run_new': 'تشغيل تحليل جديد',
  'results.nearby_garages': 'ورش قريبة:',

  'chat.title': 'محادثة درايف سنس',
  'chat.find_garages': 'ابحث عن ورش قريبة',
  'chat.placeholder': 'اسأل عن مركبتك...',
  'chat.connecting': 'جاري الاتصال بالصوت...',
  'chat.live': 'مباشر',
  'chat.voice_connecting_msg': 'جاري الاتصال بالوكيل الصوتي...',
  'chat.voice_open_msg': 'تم فتح الاتصال. يمكنك البدء بالتحدث.',
  'chat.voice_closed_msg': 'تم إغلاق الاتصال الصوتي.',
  'chat.voice_perm_error': 'تعذر الوصول إلى الميكروفون. يرجى السماح وإعادة المحاولة.',
  'chat.voice_key_error': 'المحادثة الصوتية تتطلب مفتاح GEMINI_API_KEY. الرجاء إضافته وإعادة التشغيل.',
  'chat.location_error': 'تعذر الوصول إلى موقعك. فعّل أذونات الموقع لاستخدام هذه الميزة.',
  'chat.maps_error': 'عذرًا، لم أتمكن من العثور على ورش قريبة. تأكد من تفعيل خدمات الموقع.',

  'login.welcome': 'مرحبًا بك في درايف سنس',
  'login.subtitle': 'سجّل الدخول للمتابعة',
  'login.username': 'اسم المستخدم',
  'login.password': 'كلمة المرور',
  'login.signin': 'تسجيل الدخول',
  'login.username_ph': 'أدخل أي اسم مستخدم',
  'login.password_ph': 'أدخل أي كلمة مرور',

  'profile.member': 'عضو QIC',
  'profile.name': 'الاسم',
  'profile.language': 'اللغة',
  'profile.drivingStyle': 'أسلوب القيادة',
  'profile.style.calm': 'هادئ',
  'profile.style.normal': 'عادي',
  'profile.style.aggressive': 'عدواني',
  'profile.loyalty_points': 'نقاط ولاء QIC',
  'profile.service_history': 'سجل الصيانة',

  'welcome.title': 'كير كاست',
  'welcome.subtitle': 'صيانة تنبؤية لمركبتك. لن تفوتك خدمة بعد الآن.',
  'welcome.feature1.title': 'تنبؤات ذكية',
  'welcome.feature1.desc': 'توقعات صيانة مدعومة بالذكاء الاصطناعي بناءً على عادات قيادتك',
  'welcome.feature2.title': 'تنبيهات في الوقت المناسب',
  'welcome.feature2.desc': 'احصل على إشعارات قبل أن تصبح المشاكل مكلفة',
  'welcome.get_started': 'ابدأ الآن',
  'welcome.have_account': 'لدي حساب بالفعل',

  'onboarding.choose_setup': 'اختر الإعداد',
  'onboarding.select_usage': 'حدد كيف ستستخدم كير كاست',
  'onboarding.back': 'رجوع',
  'onboarding.type.personal': 'مركبة شخصية',
  'onboarding.type.personal_desc': 'تتبع صيانة سيارتك الشخصية',
  'onboarding.type.family': 'أسطول عائلي',
  'onboarding.type.family_desc': 'إدارة عدة مركبات عائلية',
  'onboarding.type.commercial': 'أسطول تجاري',
  'onboarding.type.commercial_desc': 'إدارة أسطول محترفة',

  'onboarding.vehicle_details': 'تفاصيل المركبة',
  'onboarding.basic_info': 'أخبرنا عن مركبتك',
  'onboarding.make': 'الصانع',
  'onboarding.make_ph': 'مثال: تويوتا',
  'onboarding.model': 'الموديل',
  'onboarding.model_ph': 'مثال: كامري',
  'onboarding.year': 'السنة',
  'onboarding.year_ph': 'مثال: 2020',
  'onboarding.mileage': 'المسافة المقطوعة',
  'onboarding.mileage_ph': 'مثال: 45000',
  'onboarding.continue': 'متابعة',

  'dashboard.vehicle_health': 'صحة المركبة',
  'dashboard.excellent': 'ممتاز',
  'dashboard.upcoming_maintenance': 'الصيانة القادمة',
  'dashboard.oil_change': 'تغيير الزيت',
  'dashboard.tire_rotation': 'تدوير الإطارات',
  'dashboard.brake_inspection': 'فحص الفرامل',
  'dashboard.due_in': 'مستحق في',
  'dashboard.miles': 'ميل',
  'dashboard.recent_service': 'سجل الخدمة الأخير',
  'dashboard.view_all': 'عرض الكل',

  'account.title': 'الحساب',
  'account.profile': 'الملف الشخصي',
  'account.email': 'البريد الإلكتروني',
  'account.phone': 'الهاتف',
  'account.vehicle_info': 'معلومات المركبة',
  'account.preferences': 'التفضيلات',
  'account.notifications': 'الإشعارات',
  'account.notification_desc': 'تلقي تذكيرات الصيانة',
  'account.language': 'اللغة',
  'account.logout': 'تسجيل الخروج',
};

const dicts: Record<LanguageCode, Dict> = { en, ar };

export const I18nContext = createContext<{ lang: LanguageCode; t: (k: string) => string }>({
  lang: 'en',
  t: (k: string) => k,
});

export const I18nProvider: React.FC<{ lang: LanguageCode; children: React.ReactNode }> = ({ lang, children }) => {
  const t = useMemo(() => {
    const d = dicts[lang] || en;
    return (k: string) => d[k] ?? en[k] ?? k;
  }, [lang]);

  return (
    <I18nContext.Provider value={{ lang, t }}>
      {children}
    </I18nContext.Provider>
  );
};

export const useI18n = () => useContext(I18nContext);
